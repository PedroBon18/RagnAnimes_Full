<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Detalhes do Anime</title>
  <!-- Ícone da aba do navegador -->
  <link rel="shortcut icon" href="/img/favicon/favicon.png" type="image/x-icon">
  <!-- Link para o arquivo CSS que estiliza esta página -->
  <link rel="stylesheet" href="anime.css" />
</head>
<body>
  <header>
    <!-- Logo do site -->
    <h1><img src="/img/logo/logo.png" alt="logo"><div class="servicos"></div></h1>
    <!-- Link de voltar para a página principal -->
    <a href="index.html" class="back-link">← Voltar</a>
  </header>

  <main class="container">
    <div class="anime-details"> 
      <img id="imagem" src="" alt="Imagem do anime" />  <!-- Imagem do anime será carregada aqui. O "src" será atualizado dinamicamente pelo JavaScript usando o campo "imagem" do objeto do anime. -->
      <div class="info"> 
        <h2 id="titulo"></h2><!-- O título do anime será inserido aqui via JavaScript usando o campo "nome" do objeto do anime. -->
        <p id="descricao"></p><!-- A descrição do anime será inserida aqui via JavaScript usando o campo "descricao" do objeto do anime. -->
      
        <div id="servicos-container" class="servicos-grid"></div>
      </div>
    </div>

    <section id="trailer-section" class="trailer-section" style="display:none;">
  <h2>Trailer</h2>
  <!--
    O <iframe> abaixo será usado para exibir o trailer do anime.
    Inicialmente, o "src" está vazio.
    Quando o usuário clicar em um anime, o JavaScript pega a URL
    do campo "trailer" do objeto do anime e insere aqui.
    Isso permite carregar o vídeo do YouTube diretamente na página.
  -->
  <iframe
    id="trailer"
    width="560"
    height="315"
    src=""
    title="Trailer do anime"
    frameborder="0"
    allowfullscreen
  ></iframe>
</section>


    <section id="error-section" style="display:none;">
      <h2>Anime não encontrado</h2>
      <p>O anime que você está procurando não existe ou foi removido.</p>
    </section>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = parseInt(params.get("id"));

    const imgElem = document.getElementById("imagem");
    const tituloElem = document.getElementById("titulo");
    const descricaoElem = document.getElementById("descricao");
    const trailerSection = document.getElementById("trailer-section");
    const trailerIframe = document.getElementById("trailer");
    const errorSection = document.getElementById("error-section");
    const animeDetailsDiv = document.querySelector(".anime-details");
    const servicosContainer = document.getElementById("servicos-container");

    fetch(`http://localhost:8080/anime/${id}`)
      .then(response => {
        if (!response.ok) throw new Error("Anime não encontrado");
        return response.json();
      })
      .then(datas => {
        const anime = datas.anime; // pega o objeto anime do DTO
        console.log(anime);
        imgElem.src = anime.imagem;
        imgElem.alt = anime.nome;
        tituloElem.textContent = anime.nome;
        descricaoElem.textContent = anime.sinopse;

        servicosContainer.innerHTML = '';
        if (anime.likes && anime.likes.length > 0) {
          anime.likes.forEach(servico => {
            const servicoHTML = `
              <a href="${servico.link}" target="_blank" class="servico-item">
                <img src="${servico.imagem}" alt="Ícone de ${servico.nome}" class="servico-icone">
                <p class="servico-nome">${servico.nome}</p>
              </a>
            `;
            servicosContainer.innerHTML += servicoHTML;
          });
        }

        trailerIframe.src = anime.trailer;
        trailerIframe.title = `Trailer de ${anime.nome}`;
        trailerSection.style.display = "block";
        errorSection.style.display = "none";
        animeDetailsDiv.style.display = "flex";
      })
      .catch(() => {
        trailerSection.style.display = "none";
        errorSection.style.display = "block";
        animeDetailsDiv.style.display = "none";
      });
  </script>
  </main>
    
      
  <!-- <script> //JavaScript
    
      // Pega o id da URL (ex: detalhes.html?id=1)
      const params = new URLSearchParams(window.location.search);
      const id = parseInt(params.get("id")); // Converte para número

      // Busca o anime no array 'animes' com base no id
      const anime = animes.find((a) => a.id === id);

      // Referências aos elementos do DOM onde os dados serão exibidos
      const imgElem = document.getElementById("imagem"); // Imagem do anime
      const tituloElem = document.getElementById("titulo"); // Título do anime
      const descricaoElem = document.getElementById("descricao"); // Descrição do anime
      const trailerSection = document.getElementById("trailer-section"); // Seção do trailer
      const trailerIframe = document.getElementById("trailer"); // Iframe do trailer
      const errorSection = document.getElementById("error-section"); // Seção de erro
      const animeDetailsDiv = document.querySelector(".anime-details"); // Div de detalhes do anime

      // NOVA REFERÊNCIA AO CONTAINER DOS SERVIÇOS
      const servicosContainer = document.getElementById("servicos-container");

      // Se o anime existir no array
      if (anime) {
        // Atualiza a imagem, título e descrição
        imgElem.src = anime.imagem;
        imgElem.alt = anime.nome;
        tituloElem.textContent = anime.nome;
        descricaoElem.textContent = anime.descricao;

        // Limpa o container de serviços antes de adicionar os novos
      servicosContainer.innerHTML = '';

      // Verifica se o anime tem algum serviço cadastrado (e se a lista não está vazia)
      if (anime.servicos && anime.servicos.length > 0) {

        // Percorre cada serviço da lista (ex: Netflix, Crunchyroll, etc.)
        anime.servicos.forEach(servico => {

          // Cria o HTML de um serviço:
          // - <a> com link para o site do serviço (abre em nova aba)
          // - <img> para mostrar o ícone do serviço
          // - <p> com o nome do serviço
          const servicoHTML = `
            <a href="${servico.link}" target="_blank" class="servico-item">
              <img src="${servico.icone}" alt="Ícone de ${servico.nome}" class="servico-icone">
              <p class="servico-nome">${servico.nome}</p>
            </a>
          `;

          // Adiciona esse HTML no container (acumulando os serviços)
          servicosContainer.innerHTML += servicoHTML;
        });
      }

        // Coloca o link do trailer no iframe
        trailerIframe.src = anime.trailer;
        trailerIframe.title = `Trailer de ${anime.nome}`;

        // Mostra a seção do trailer e esconde a mensagem de erro
        trailerSection.style.display = "block";
        errorSection.style.display = "none";
        animeDetailsDiv.style.display = "flex";
      } else {
        // Se não encontrou o anime, esconde trailer e detalhes
        // Mostra a mensagem de erro
        trailerSection.style.display = "none";
        errorSection.style.display = "block";
        animeDetailsDiv.style.display = "none";
      }


  </script> 

</body>
</html>
